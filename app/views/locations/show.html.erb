<% require 'pry' %>

<h1><%= @location.name %></h1><br>
<h2><%= @location.neighborhood %></h2><br>

<h3><%= @location.address %><br>
<%= @location.city %>, <%= @location.state %> <%= @location.zip_code %></h3><br>

<h2>Reviews for <%= @location.name %></h2>
<% @reviews.each do |review| %>
  <%= Review::RATINGS[review.rating - 1][1] %><br>
  <%= review.flavor %>
  <br>
  <em><%= review.body %></em>

  <% @vote = Vote.find_by(review_id: review.id, user_id: current_user.id)  %>
  <% unless @vote.nil? %>
    <% if @vote.count == 1 %>
      <% @upvote = "upvote" %>
      <% @downvote = "" %>
    <% elsif @vote.count == -1 %>
      <% @upvote = "" %>
      <% @downvote = "downvote" %>
    <% else %>
      <% @upvote = "" %>
      <% @downvote = "" %>
    <% end %>
  <% end %>
    <i class="fa fa-thumbs-o-up" id=<%="#{@upvote} js-upvote" %> data_user=current_user.id data_review=@review.id data_value = 1 aria-hidden="true"></i><%= button_to '+1', upvote_review_path(review), method: :post %>
    <i class="fa fa-thumbs-o-down" id=<%=@downvote %> data_user=current_user.id data_review=@review.id data_value = -1 aria-hidden="true"></i><%= button_to '-1', downvote_review_path(review), method: :post %>
  <br><br>
  <% if review.user_id == current_user.id && !review.id.nil? || current_user.admin? %>
    <li><%= link_to 'Delete ' + review.flavor + ' review', location_review_path(@location.id, review), { method: :delete, id: review.id} %></li>
  <% end %>
  <% if current_user.id == review.user_id && !review.id.nil? %>
    <li><%= link_to 'Edit ' + review.flavor + ' review', edit_location_review_path(@location, review), { id: review.id }%></li>
  <% end %>
  <br><br>
  <% if current_user.admin? %>
    <li> <%= link_to 'Delete Review', location_review_path(review.id), { method: :delete, id: review.id }%> </li>
  <% end %>
<% end %>

<%= link_to 'Add a Review', new_location_review_path(@location) %><br>
<%= link_to 'Back to Locations', locations_path %>
